# Vision Translator

macOSネイティブのVision Frameworkを使用した、高精度・高速な画面翻訳アプリです。画面の指定した領域をキャプチャし、その中のテキストを翻訳して元の画像の上に日本語を重ねて表示します。

## 主な機能

-   **領域選択キャプチャ**: `screencapture` コマンドを使用して、翻訳したい範囲をマウスで指定できます。
-   **高精度OCR**: macOS標準のVision Frameworkを使用し、日本語（ja-JP）と英語（en-US）をコンテキストに含めて高精度に認識します。
-   **画像上書き翻訳**: 認識されたテキストの位置を特定し、元のテキストを隠した上で、翻訳後の日本語を正確な位置に描画します。
-   **翻訳の高速化**: 複数のテキストフラグメントを並列（マルチスレッド）で翻訳処理することで、レスポンスを向上させています。
-   **日本語判定**: すでに日本語であるテキストを検出し、二重翻訳による誤変換を防ぎます。
-   **モダンなUI**: ガラスモフィズムを採用した、ダークモード調の洗練されたインターフェース。

## 必要条件

-   **OS**: macOS (Vision Frameworkを使用するため)
-   **Python**: 3.8以上
-   **ツール**: [uv](https://docs.astral.sh/uv/)
-   **依存ライブラリ**:
    -   `pywebview`: GUI表示用
    -   `Pillow`: 画像処理用
    -   `deep-translator`: 翻訳エンジン
    -   `pyobjc`: macOS APIへのブリッジ

## セットアップ

1.  **uvのインストール**（未導入の場合）:
    ```bash
    curl -LsSf https://astral.sh/uv/install.sh | sh
    ```

2.  **環境構築**:
    プロジェクトディレクトリで以下のコマンドを実行し、仮想環境の作成と依存ライブラリのインストールを自動で行います。
    ```bash
    uv sync
    ```

3.  フォントの確認:
    -   デフォルトで `Hiragino Sans GB` などのmacOS標準日本語フォントを使用します。

## 使い方

1.  **アプリを起動します**:
    ```bash
    uv run app.py
    ```
    ※ `run.sh` を使用して起動することも可能です。

2.  **「📸 領域を切取って翻訳」ボタンをクリック**します。
3.  **画面がキャプチャモードになる**ので、翻訳したい範囲をドラッグで選択します。
4.  **数秒待機**すると、翻訳結果が上書きされた画像が表示されます。

## 技術詳細

-   **環境管理**: `uv` を使用してプロジェクトの依存関係（`pyproject.toml`）を管理しています。
-   **OCR**: `VNRecognizeTextRequest` を使用して、文字だけでなく `boundingBox`（座標）も取得しています。
-   **画像処理**: ディスクへの書き込みを最小限にし、メモリ上で Base64 変換を行って UI に渡すことで高速化を実現しています。
-   **並列処理**: `ThreadPoolExecutor` を用いて、Google翻訳 API へのリクエストを並列化しています。
